package com.fcmb.rovaclearbankintegrations;

import com.fasterxml.jackson.core.type.TypeReference;
import com.fcmb.rovaclearbankintegrations.configuration.ConfigProperties;
import com.fcmb.rovaclearbankintegrations.controllers.WebhookControllers;
import com.fcmb.rovaclearbankintegrations.exception.RovaException;
import com.fcmb.rovaclearbankintegrations.infra.kafka.service.producer.EventProducer;
import com.fcmb.rovaclearbankintegrations.models.RovaRequestPayload;
import com.fcmb.rovaclearbankintegrations.models.dtos.ComplyAdvantageTransactionRequest;
import com.fcmb.rovaclearbankintegrations.models.dtos.RovaAccountTransferDto;
import com.fcmb.rovaclearbankintegrations.models.requests.ClearBankTransactionSettledRequest;
import com.fcmb.rovaclearbankintegrations.models.requests.CoreBankingTermDepositAccountCreationGenericRequest;
import com.fcmb.rovaclearbankintegrations.models.requests.RovaVirtualAccountCreationRequest;
import com.fcmb.rovaclearbankintegrations.models.requests.RovaVirtualAccountDeletionRequest;
import com.fcmb.rovaclearbankintegrations.models.responses.ComplyAdvantageTransactionResponse;
import com.fcmb.rovaclearbankintegrations.services.accountManagementServices.accountCreationService.AccountCreationService;
import com.fcmb.rovaclearbankintegrations.services.accountManagementServices.accountRetrievalService.AccountRetrievalService;
import com.fcmb.rovaclearbankintegrations.services.cacheServices.CacheService;
import com.fcmb.rovaclearbankintegrations.services.glServices.GlService;
import com.fcmb.rovaclearbankintegrations.services.glServices.GlServiceImpl;
import com.fcmb.rovaclearbankintegrations.services.paymentManagementServices.fasterPaymentServices.PaymentManagementService;
import com.fcmb.rovaclearbankintegrations.services.termDepositAccountServices.TermDepositAccountService;
import com.fcmb.rovaclearbankintegrations.utilities.AppUtils;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import java.math.BigDecimal;
import java.time.Instant;
import java.time.LocalDate;
import java.time.ZoneId;
import java.time.ZonedDateTime;
import java.time.format.DateTimeFormatter;
import java.util.regex.Pattern;

import static com.fcmb.rovaclearbankintegrations.utilities.AppUtils.*;
import static com.fcmb.rovaclearbankintegrations.utilities.KafkaUtility.*;
import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.junit.jupiter.api.Assertions.assertTrue;

@SpringBootTest
class RovaClearbankIntegrationsApplicationTests {
    @Autowired
    EventProducer eventProducer;
    @Autowired
    AccountRetrievalService accountRetrievalService;
    @Autowired
    AccountCreationService accountCreationService;
    @Autowired
    AppUtils objectMapper;
    @Autowired
    ConfigProperties configProperties;
    @Autowired
    PaymentManagementService paymentManagementService;
    @Autowired
    WebhookControllers webhookControllers;
    @Autowired
    GlServiceImpl glService;
    @Autowired
    CacheService cacheService;
    @Autowired
    TermDepositAccountService termDepositAccountService;

    @Test
    void contextLoads() throws RovaException {
        String payload2 = "{\"nominalAnnualInterestRate\":0,\"withdrawalFeeForTransfers\":true,\"allowOverdraft\":false,\"enforceMinRequiredBalance\":true,\"interestCompoundingPeriodType\":1,\"interestPostingPeriodType\":4,\"interestCalculationType\":1,\"interestCalculationDaysInYearType\":365,\"locale\":\"en\",\"clientId\":1687,\"ownerName\":\"ROAVA\",\"sortCode\":\"040695\",\"usageType\":\"YourFunds\",\"currency\":\"GBP\",\"legalEntityType\":\"individual\",\"street\":\"P\",\"country\":\"GB\",\"city\":\"London\",\"emailAddress\":\"accountDeletion25@yopmail.com\",\"phoneNumber\":\"+445533121213\",\"dateOfBirth\":\"1996-02-02\",\"firstName\":\"Account-Deletion\",\"lastName\":\"Test\",\"productId\":5}";
        RovaVirtualAccountCreationRequest request2 = objectMapper.readValue(payload2, RovaVirtualAccountCreationRequest.class);
//        CoreBankingTermDepositAccountCreationGenericRequest request = new CoreBankingTermDepositAccountCreationGenericRequest();
//        request.setActivate(true);
//        request.setClientId("1655");
//        request.setProductId(76L);
//        request.setCreatedDate("16 February 2024");
//        request.setDepositAmount(BigDecimal.valueOf(1.00));
//        request.setInterestRate(3.5);
//        request.setSavingsAccountId(1769L);
//        request.setDepositPeriodFrequencyId(0L);
        cacheService.cacheFineractSavingsAccountCreationData("123", request2);
        RovaVirtualAccountCreationRequest retrievedData = cacheService.retrieveFineractSavingsAccountCreationData("123", "FineractSavingsAccountData");
        assertNotNull(retrievedData);
    }

    @Test
    void testCA() throws RovaException {
        String payload = "{\"id\":\"4725c7a88f1549d288467a3ac4220276\",\"data\":{\"tx_id\":\"4725c7a88f1549d288467a3ac4220276\",\"tx_direction\":\"Outbound\",\"tx_base_currency\":\"USD\",\"customer_id\":\"69516645\",\"customer_name\":\"Raj Singh\",\"tx_base_amount\":0.5,\"tx_currency\":\"USD\",\"tx_amount\":0.5,\"tx_date_time\":\"2024-03-04 19:22:51\",\"counterparty_id\":\"79373419\",\"counterparty_name\":\"Ishioma Mokodi\",\"tx_reference_text\":\"xx\",\"tx_account_balance\":\"8.260000\",\"customer_iban\":\"GB94TCCL04140469516645\",\"customer_risk\":\"HIGH\",\"customer_date_of_birth\":\"1972-1-2\",\"customer_device_id\":\"01h27sy3y0pm6w09har134jc42\",\"customer_pep\":\"false\",\"counterparty_iban\":\"GB82TCCL04140479373419\",\"counterparty_country\":\"US\",\"tx_base_balance\":\"8.260000\"},\"extraData\":{\"reference\":\"4725c7a88f1549d288467a3ac4220276\",\"requestId\":\"4725c7a88f1549d288467a3ac4220276\",\"apiName\":\"regular\",\"locale\":\"en\",\"currency\":\"USD\",\"amount\":0.5,\"debtorIban\":\"GB94TCCL04140469516645\",\"creditorIban\":\"GB82TCCL04140479373419\",\"beneficiaryId\":\"\",\"transferDescription\":\"xx\",\"contactId\":\"faf9d316-c1e6-4cd6-bb25-21589c95787d\"},\"source_format\":1}";
        ComplyAdvantageTransactionRequest complyAdvantageTransactionRequest = objectMapper.readValue(payload, ComplyAdvantageTransactionRequest.class);
        eventProducer.sendEventToPartition(objectMapper.writeValueAsString(complyAdvantageTransactionRequest), COMPLY_ADVANTAGE_REQUEST_TOPIC, 0, "payment-initiation");
    }

    @Test
    void termDepositTest() throws Exception {
        String gbpPayload = "{\"requestId\":\"term-deposit-16\",\"request\":{\"clientId\":1655,\"productId\":\"76\",\"createdDate\":\"23 February 2024\",\"savingsAccountId\":\"1769\",\"interestRate\":\"3.90\",\"depositAmount\":\"1.90\",\"depositPeriodFrequencyId\":\"0\",\"activate\":true},\"partition\":20,\"apiName\":\"Term Deposit Account Creation\"}";
        String usdPayload = "{\"requestId\":\"term-deposit-U01\",\"request\":{\"clientId\":888,\"productId\":\"76\",\"createdDate\":\"05 March 2024\",\"savingsAccountId\":\"1793\",\"interestRate\":\"3.90\",\"depositAmount\":\"1.90\",\"depositPeriodFrequencyId\":\"0\",\"activate\":true},\"partition\":20,\"apiName\":\"Term Deposit Account Creation\"}";
        TypeReference<RovaRequestPayload<CoreBankingTermDepositAccountCreationGenericRequest>> typeReference = new TypeReference<>() {
        };
        RovaRequestPayload<CoreBankingTermDepositAccountCreationGenericRequest> rovaRequestPayload = objectMapper.readValue(usdPayload, typeReference);
        termDepositAccountService.createATermDepositAccount(rovaRequestPayload, accountCreationService);
//        eventProducer.sendEventToPartition(usdPayload, CLEAR_BANK_TOPIC, 20, TERM_DEPOSIT_ACCOUNT_CREATION);
    }


    @Test
    void rovaCustomerAmendmentTest() {
        String rovaCustomerAmendmentPayload = "{\"requestId\":\"id-amend-customer-8\",\"request\":{\"clientId\":\"888\",\"emailAddress\":\"salmankhan1@gmail.com\",\"mobileNo\":\"08023564588\"},\"apiName\":\"customer-ammendment\",\"partition\":2}";
        eventProducer.sendEventToPartition(rovaCustomerAmendmentPayload, CLEAR_BANK_TOPIC, 2, "customer-ammendment");
    }

    @Test
    void rovaGBPAccountCreationTest() {
        String rovaAccountCreationPayload = "{\"requestId\":\"testAccountCreationGBP27\",\"request\":{\"nominalAnnualInterestRate\":0,\"withdrawalFeeForTransfers\":false,\"allowOverdraft\":false,\"enforceMinRequiredBalance\":false,\"interestCompoundingPeriodType\":1,\"interestPostingPeriodType\":4,\"interestCalculationType\":1,\"interestCalculationDaysInYearType\":365,\"locale\":\"en\",\"charges\":[{\"chargeId\":3,\"amount\":1},{\"chargeId\":2,\"amount\":20}],\"clientId\":\"1664\",\"productId\":\"5\",\"firstName\":\"John\",\"lastName\":\"Doe\",\"ownerName\":\"Open Factor\",\"sortCode\":\"040695\",\"usageType\":\"YourFunds\",\"currency\":\"GBP\",\"legalEntityType\":\"individual\",\"street\":\"ladipo\",\"country\":\"GB\",\"city\":\"Lagos\",\"emailAddress\":\"mikejack13@gmail.com\",\"phoneNumber\":\"277237930213\",\"dateOfBirth\":\"1998-11-17\"},\"apiName\":\"account-creation\",\"partition\":9}";
        String rovaAccountCreationPayload2 = "{\"requestId\":\"testAccountCreationGBP21\",\"request\":{\"nominalAnnualInterestRate\":0,\"withdrawalFeeForTransfers\":true,\"allowOverdraft\":false,\"enforceMinRequiredBalance\":true,\"interestCompoundingPeriodType\":1,\"interestPostingPeriodType\":4,\"interestCalculationType\":1,\"interestCalculationDaysInYearType\":365,\"locale\":\"en\",\"clientId\":1001,\"ownerName\":\"ROAVA\",\"sortCode\":\"041369\",\"usageType\":\"YourFunds\",\"currency\":\"\",\"legalEntityType\":\"individual\",\"street\":\"2345 Fat Way\",\"country\":\"GB\",\"city\":\"Liverpool\",\"emailAddress\":\"rolex1234@yopmail.com\",\"phoneNumber\":\"+446969696969\",\"dateOfBirth\":\"05-11-1993\",\"firstName\":\"Ericson\",\"lastName\":\"Clinton\",\"productId\":\"5\"},\"apiName\":\"account-creation\",\"partition\":9}";

        eventProducer.sendEventToPartition(rovaAccountCreationPayload, CLEAR_BANK_TOPIC, 9, "account-creation");
    }

    @Test
    void rovaUSDAccountCreationTest() throws RovaException {
        String rovaAccountCreationPayload = "{\"requestId\":\"366ea56e32814207848fe3ad9253f240\",\"request\":{\"nominalAnnualInterestRate\":0,\"withdrawalFeeForTransfers\":true,\"allowOverdraft\":false,\"enforceMinRequiredBalance\":true,\"interestCompoundingPeriodType\":1,\"interestPostingPeriodType\":4,\"interestCalculationType\":1,\"interestCalculationDaysInYearType\":365,\"locale\":\"en\",\"clientId\":1707,\"ownerName\":\"ROAVA\",\"sortCode\":\"040695\",\"usageType\":\"YourFunds\",\"currency\":\"USD\",\"legalEntityType\":\"individual\",\"street\":\"P\",\"country\":\"GB\",\"city\":\"London\",\"emailAddress\":\"sly2081@yopmail.com\",\"phoneNumber\":\"+448100000010\",\"dateOfBirth\":\"1993-02-22\",\"firstName\":\"Chuks-a\",\"lastName\":\"Sly\",\"productId\":2},\"apiName\":\"create-real-account\",\"partition\":9}";
        TypeReference<RovaRequestPayload<RovaVirtualAccountCreationRequest>> typeReference = new TypeReference<>() {
        };
        RovaRequestPayload<RovaVirtualAccountCreationRequest> rovaRequestPayload = objectMapper.readValue(rovaAccountCreationPayload, typeReference);
//        accountCreationService.createRovaVirtualAccount(rovaRequestPayload);
        eventProducer.sendEventToPartition(rovaAccountCreationPayload, CLEAR_BANK_TOPIC, 9, "account-creation");
    }

    @Test
    void rovaGBPVirtualAccountCreationTest() throws RovaException {
        String rovaAccountCreationPayload = "{\"requestId\":\"testVACreationGBP18\",\"request\":{\"nominalAnnualInterestRate\":0,\"withdrawalFeeForTransfers\":false,\"allowOverdraft\":false,\"enforceMinRequiredBalance\":false,\"interestCompoundingPeriodType\":1,\"interestPostingPeriodType\":4,\"interestCalculationType\":1,\"interestCalculationDaysInYearType\":365,\"locale\":\"en\",\"charges\":[{\"chargeId\":3,\"amount\":1},{\"chargeId\":2,\"amount\":20}],\"clientId\":\"1664\",\"productId\":\"5\",\"firstName\":\"Account-Deletion\",\"lastName\":\"Test\",\"currency\":\"GBP\"},\"apiName\":\"account-creation\",\"partition\":15}";
        String payload2 = "{\"requestId\":\"testVACreationGBP40\",\"request\":{\"nominalAnnualInterestRate\":0,\"withdrawalFeeForTransfers\":true,\"allowOverdraft\":false,\"enforceMinRequiredBalance\":true,\"interestCompoundingPeriodType\":1,\"interestPostingPeriodType\":4,\"interestCalculationType\":1,\"interestCalculationDaysInYearType\":365,\"locale\":\"en\",\"clientId\":1687,\"ownerName\":\"ROAVA\",\"sortCode\":\"040695\",\"usageType\":\"YourFunds\",\"currency\":\"GBP\",\"legalEntityType\":\"individual\",\"street\":\"P\",\"country\":\"GB\",\"city\":\"London\",\"emailAddress\":\"accountDeletion28@yopmail.com\",\"phoneNumber\":\"+445533121213\",\"dateOfBirth\":\"1996-02-02\",\"firstName\":\"Account-Deletion\",\"lastName\":\"Test\",\"productId\":5},\"apiName\":\"create-virtual-account\",\"partition\":15}";
        String payloadUsd = "{\"requestId\":\"testVACreationUSD03\",\"request\":{\"nominalAnnualInterestRate\":0,\"withdrawalFeeForTransfers\":true,\"allowOverdraft\":false,\"enforceMinRequiredBalance\":true,\"interestCompoundingPeriodType\":1,\"interestPostingPeriodType\":4,\"interestCalculationType\":1,\"interestCalculationDaysInYearType\":365,\"locale\":\"en\",\"clientId\":1687,\"ownerName\":\"ROAVA\",\"sortCode\":\"040695\",\"usageType\":\"YourFunds\",\"currency\":\"USD\",\"legalEntityType\":\"individual\",\"street\":\"P\",\"country\":\"GB\",\"city\":\"London\",\"emailAddress\":\"paymentreversal@yopmail.com\",\"phoneNumber\":\"+445533131214\",\"dateOfBirth\":\"1996-02-02\",\"firstName\":\"Payment\",\"lastName\":\"Reversal\",\"productId\":2},\"apiName\":\"create-virtual-account\",\"partition\":15}";
        TypeReference<RovaRequestPayload<RovaVirtualAccountCreationRequest>> typeReference = new TypeReference<>() {
        };
        RovaRequestPayload<RovaVirtualAccountCreationRequest> rovaRequestPayload = objectMapper.readValue(payloadUsd, typeReference);
        accountCreationService.createRovaVirtualAccount(rovaRequestPayload);
//        eventProducer.sendEventToPartition(payloadUsd, CLEAR_BANK_TOPIC, 15, "account-creation");
    }

    @Test
    void rovaAccountAmendmentTest() {
        String rovaAccountAmendmentPayload = "{\"requestId\":\"id-amend1\",\"request\":{\"clientId\":\"198\",\"externalAccountId\":\"42277499-445f-44b4-9dc3-4140e677702c\",\"firstname\":\"Amendment\",\"lastname\":\"Test\",\"active\":true,\"accountNo\":\"0000000198\",\"isStaff\":false,\"genderId\":20,\"clientNonPersonDetails\":{},\"legalFormId\":1,\"locale\":\"en\",\"status\":\"NotProvided\",\"statusReason\":\"NotProvided\",\"ownerName\":\"string\",\"legalOwnerType\":\"Personal\",\"relationshipType\":\"Single\",\"minimumBalance\":0},\"apiName\":\"account-ammendment\",\"partition\":12}";
        eventProducer.sendEventToPartition(rovaAccountAmendmentPayload, CLEAR_BANK_TOPIC, 12, "account-ammendment");
    }

    @Test
    void rovaVirtualAccountAmendmentTest() {
        String rovaVirtualAccountAmendmentPayload = "{\"requestId\":\"id-amend2\",\"request\":{\"clientId\":\"198\",\"externalAccountId\":\"b7146585-443c-46c2-b8df-fae25c89089b\",\"externalVirtualAccountId\":\"3ecd4d04-adc3-4baa-ab3f-00105204fbb8\",\"firstname\":\"Gen Seg Acc Wsale\",\"lastname\":\"FCMB Bank UK Ltd\",\"active\":true,\"accountNo\":\"0000000198\",\"isStaff\":false,\"genderId\":20,\"clientNonPersonDetails\":{},\"legalFormId\":1,\"locale\":\"en\",\"ownerName\":\"string\",\"legalOwnerType\":\"Personal\",\"relationshipType\":\"Single\"},\"apiName\":\"virtual-account-ammendment\",\"partition\":18}";
        eventProducer.sendEventToPartition(rovaVirtualAccountAmendmentPayload, CLEAR_BANK_TOPIC, 18, "virtual-account-amendment");
    }

    @Test
    void rovaVirtualAccountDeletionTest() {
        String rovaVirtualAccountDeletionPayload = "{\"requestId\":\"id-delete\",\"request\":{\"externalAccountId\":\"b7146585-443c-46c2-b8df-fae25c89089b\",\"externalVirtualAccountId\":\"3ecd4d04-adc3-4baa-ab3f-00105204fbb8\",\"locale\":\"en\",\"accountId\":\"192\"},\"apiName\":\"virtual-account-deletion\",\"partition\":24}";
        eventProducer.sendEventToPartition(rovaVirtualAccountDeletionPayload, CLEAR_BANK_TOPIC, 24, "virtual-account-deletion");
    }

    @Test
    void GBPPaymentInitiationTest() throws RovaException {
        String complyAdvGreenResponse = "{\"result\":{\"id\":\"id-payment-e0\",\"cancelled\":false,\"have_all_passed\":true,\"transaction_datetime\":\"2024-01-26T14:45:57Z\",\"internal_id\":34370,\"source_format\":1,\"stored_data\":{\"tx_id\":\"id-payment-e0\",\"tx_direction\":\"Outbound\",\"tx_base_currency\":\"GBP\",\"customer_id\":\"00044190\",\"customer_name\":\"Alagba Ede\",\"tx_base_amount\":\"0.02\",\"tx_currency\":\"GBP\",\"tx_amount\":\"0.02\",\"tx_date_time\":\"2024-01-26T14:45:57+00:00\",\"counterparty_id\":\"00046044\",\"counterparty_name\":\"MIKE MIKE\",\"customer_iban\":\"GB15CLRB04069500044190\",\"customer_date_of_birth\":\"1998-11-18T00:00:00+00:00\",\"counterparty_iban\":\"GB09CLRB04069500046044\",\"tx_base_balance\":\"1728.380000\"},\"rule_results\":[{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":17,\"name\":\"Percentage of Balance - Individual\",\"code\":\"POBI\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":18,\"name\":\"Percentage of Balance - Multiple\",\"code\":\"POBM\",\"alert_grouping_version\":\"6.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":22,\"name\":\"Smurfing - Inbound\",\"code\":\"SMURFIN\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":23,\"name\":\"New Customer - Outbound\",\"code\":\"NEWOUT\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":24,\"name\":\"High Value Outlier\",\"code\":\"HVO\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":25,\"name\":\"Multiple Currencies\",\"code\":\"MCU\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":27,\"name\":\"Vulnerable Customer - Outbound\",\"code\":\"VCO\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":29,\"name\":\"Young Customer - GBP\",\"code\":\"VCLOWGBP\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":30,\"name\":\"Elderly Customer - GBP\",\"code\":\"VCELDGBP\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":31,\"name\":\"Modern Slavery & Sexual Exploitation\",\"code\":\"MSSE\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":32,\"name\":\"Movement of Funds\",\"code\":\"MOF\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":34,\"name\":\"Exchange Services\",\"code\":\"EXSERV\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":35,\"name\":\"High Risk Country\",\"code\":\"HRCOU\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":36,\"name\":\"Medium Risk Country\",\"code\":\"MRCOU\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":37,\"name\":\"Account Selling - GBP\",\"code\":\"SELLGBP\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":39,\"name\":\"Tax Haven Country - GBP\",\"code\":\"TAXGBP\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":45,\"name\":\"Prohibited Country\",\"code\":\"PCOU\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":48,\"name\":\"PEPs Screening\",\"code\":\"PEP\",\"alert_grouping_version\":\"4.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":65,\"name\":\"Reference Text Entity Screening\",\"code\":\"REFTEXT\",\"alert_grouping_version\":\"4.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":66,\"name\":\"Risk Words Reference Text\",\"code\":\"RISKWORD\",\"alert_grouping_version\":\"5.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":67,\"name\":\"Percentage of Balance\",\"code\":\"P-%BAL\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":68,\"name\":\"Payment Limit - Inbound\",\"code\":\"P-TLI\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":69,\"name\":\"Payment Limit - Outbound\",\"code\":\"P-TLO\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":70,\"name\":\"High Velocity - Outbound\",\"code\":\"P-HVO\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":71,\"name\":\"High Velocity - Inbound\",\"code\":\"P-HVI\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":72,\"name\":\"High Cumulative Amount - Outbound\",\"code\":\"P-HSUMO\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":73,\"name\":\"High Cumulative Amount - Inbound\",\"code\":\"P-HSUMI\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":74,\"name\":\"High Account Balance\",\"code\":\"P-LBAL\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":75,\"name\":\"First Transaction\",\"code\":\"P-1st\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":76,\"name\":\"Second Transaction\",\"code\":\"P-2nd\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":77,\"name\":\"Similar Amounts - Inbound\",\"code\":\"IN>%OUT\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":78,\"name\":\"Similar Amounts - Outbound\",\"code\":\"OUT>%IN\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":79,\"name\":\"High Value Withdrawal Following High Number of Deposits\",\"code\":\"IN-OUT-2\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":80,\"name\":\"Withdrawal Greater Than a Percentage of the Preceding Deposits\",\"code\":\"IN-OUT-1\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":81,\"name\":\"Structuring - Inbound - High Risk Limit\",\"code\":\"STRINHR\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":86,\"name\":\"Structuring - Outbound - High Risk Limit\",\"code\":\"STROUTHR\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":87,\"name\":\"Vulnerable Customer\",\"code\":\"VC\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":88,\"name\":\"Round Value Transactions - Inbound\",\"code\":\"RVT-IN\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":89,\"name\":\"Round Value Transactions - Outbound\",\"code\":\"RVT-OUT\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":90,\"name\":\"High Number of High Value Round Transactions - Inbound\",\"code\":\"HNR-IN\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":91,\"name\":\"High Number of High Value Round Transactions - Outbound\",\"code\":\"HNR-OUT\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":92,\"name\":\"New Counterparty Country\",\"code\":\"NCOU\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":93,\"name\":\"New Counterparty Bank Country\",\"code\":\"NBCOU\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":94,\"name\":\"High Risk Currency\",\"code\":\"HRCU\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":95,\"name\":\"New Currency\",\"code\":\"NCU\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":96,\"name\":\"Multiple Customers, One Counterparty (Distinct)\",\"code\":\"MCOC_1\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":97,\"name\":\"Multiple Counterparties, One Customer (Distinct)\",\"code\":\"OCMC_1\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":98,\"name\":\"High Cumulative Amount - Inbound - Counterparty\",\"code\":\"SUMCCI\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":99,\"name\":\"High Cumulative Amount - Outbound - Counterparty\",\"code\":\"SUMCCO\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":100,\"name\":\"High Velocity - Inbound - Counterparty\",\"code\":\"NUMCCI\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":101,\"name\":\"High Velocity - Outbound - Counterparty\",\"code\":\"NUMCCO\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":102,\"name\":\"Sudden Activity\",\"code\":\"DORMANT\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":103,\"name\":\"High Cumulative Amount Historic Average - Inbound\",\"code\":\"HASUMI\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":104,\"name\":\"High Cumulative Amount Historic Average - Outbound\",\"code\":\"HASUMO\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":105,\"name\":\"High Velocity Historic Average - Inbound\",\"code\":\"HANUMI\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":106,\"name\":\"High Velocity Historic Average - Outbound\",\"code\":\"HANUMO\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":107,\"name\":\"Transaction Limit - Historic Average - Inbound\",\"code\":\"IN>AVG\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":108,\"name\":\"Transaction Limit - Historic Average - Outbound\",\"code\":\"OUT>AVG\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":109,\"name\":\"High Velocity Safe Custody Account Usage - Historic Average\",\"code\":\"SAFE>HA\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":110,\"name\":\"Multiple Detail Change\",\"code\":\"CDC01\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":113,\"name\":\"Risk Words Counterparty Name\",\"code\":\"RISKNAME\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true}],\"updated_at\":\"2024-01-26T14:45:57.737642Z\"},\"extraData\":{\"reference\":\"id-payment-e0\",\"requestId\":\"id-payment-e0\",\"locale\":\"en\",\"currency\":\"GBP\",\"amount\":\"0.02\",\"debtorIban\":\"GB15CLRB04069500044190\",\"creditorIban\":\"GB09CLRB04069500046044\",\"transferDescription\":\"GL updates\"},\"errors\":[]}";
        ComplyAdvantageTransactionResponse complyAdvantageTransactionResponse = objectMapper.readValue(complyAdvGreenResponse, ComplyAdvantageTransactionResponse.class);
//        paymentManagementService.initiatePayment(complyAdvantageTransactionResponse);

        for (int i = 91; i < 92; i++) {
            String paymentInitiationPayload = "{\"requestId\":\"id-payment-b31" + i + "\",\"request\":{\"fromAccountId\":1283," +
                    "\"fromAccountType\":4,\"toOfficeId\":1,\"toClientId\":909,\"toAccountType\":2,\"toAccountId\":1288," +
                    "\"transferAmount\":\"0.4\",\"transferDescription\":\"GL updates\",\"locale\":\"en\"," +
                    "\"fromClientId\":908,\"fromOfficeId\":1,\"txDirection\":\"Outbound\",\"currency\":\"GBP\"," +
                    "\"customerName\":\"Alagba Ede\",\"counterpartyName\":\"MIKE MIKE\"," +
                    "\"debtorIban\":\"GB67CLRB04069500044321\",\"creditorIban\":\"GB77CLRB04069500044335\"," +
                    "\"reference\":\"id-payment-b31" + i + "\"},\"apiName\":\"payment-initiation\",\"partition\":27}";
            eventProducer.sendEventToPartition(paymentInitiationPayload, CLEAR_BANK_TOPIC, 27, "payment-initiation");
        }
        TypeReference<RovaRequestPayload<RovaAccountTransferDto>> typeReference = new TypeReference<>() {
        };
//        RovaRequestPayload<RovaAccountTransferDto> rovaRequestPayload = objectMapper.readValue(paymentInitiationPayload, typeReference);
//        paymentManagementService.debitCustomerCreditTransitGl(rovaRequestPayload);
    }

    @Test
    void complyAdvTest() throws RovaException {
        String payload = "{\"id\":\"2641add0-20250\",\"data\":{\"tx_id\":\"2641add0-20250\",\"tx_direction\":\"Outbound\",\"tx_base_currency\":\"USD\",\"customer_id\":\"88815958\"," +
                "\"customer_name\":\"Tosin David\",\"tx_base_amount\":\"2\",\"tx_currency\":\"USD\"," +
                "\"tx_amount\":\"2\",\"tx_date_time\":\"2024-01-26 09:45:39\",\"counterparty_id\":\"77501097\",\"counterparty_name\":\"Mike Charles\"," +
                "\"tx_reference_text\":\"GL updates\",\"customer_iban\":\"GB10TCCL12345677501097\",\"customer_date_of_birth\":\"1998-11-17\"," +
                "\"counterparty_iban\":\"GB69TCCL12345688815958\",\"counterparty_country\":\"US\",\"tx_base_balance\":\"30086.120000\",\"customer_ach_routing_code\":\"026073150\",\"customer_fedwire_routing_number\":\"026073008\"}," +
                "\"extraData\":{\"reference\":\"id-payment-a18\",\"requestId\":\"id-payment-a18\",\"apiName\":\"regular\",\"locale\":\"en\",\"currency\":\"USD\",\"amount\":\"0.02\"," +
                "\"debtorIban\":\"GB10TCCL12345677501097\",\"creditorIban\":\"GB69TCCL12345688815958\"," +
                "\"beneficiaryId\":\"d061cb2f-1349-4818-bb40-4edba6088220\",\"transferDescription\":\"GL updates\"," +
                "\"contactId\":\"ffb3eb02-01b8-436d-9801-4ce1169788a6\"},\"source_format\":1}";
        ComplyAdvantageTransactionRequest complyAdvantageTransactionRequest = objectMapper.readValue(payload, ComplyAdvantageTransactionRequest.class);
        eventProducer.sendEventToPartition(objectMapper.writeValueAsString(complyAdvantageTransactionRequest), COMPLY_ADVANTAGE_REQUEST_TOPIC, 0, "payment-initiation");
    }

    @Test
    void USDPaymentInitiationTest() throws RovaException {
        boolean isNull = true;
        String creditorIban = isNull ? null : "GB69TCCL12345688815958";
        String manualTransfer = "{\"result\":{\"id\":\"588b4f25-f63c-4d03-b22e-2368aa7c03b9\",\"cancelled\":false,\"have_all_passed\":true,\"transaction_datetime\":\"2024-01-27T07:07:37Z\",\"internal_id\":244,\"source_format\":1,\"stored_data\":{\"tx_id\":\"588b4f25-f63c-4d03-b22e-2368aa7c03b9\",\"tx_direction\":\"INBOUND\",\"tx_base_currency\":\"USD\",\"customer_id\":\"88815958\",\"customer_name\":\"Tosin David\",\"tx_base_amount\":\"5\",\"tx_currency\":\"USD\",\"tx_amount\":\"5\",\"tx_date_time\":\"2024-01-27T07:07:37+00:00\",\"counterparty_id\":\"bd6a940d-1e92-4b49-b226-604aeffd35e2\",\"counterparty_name\":\"Rova Technologies\",\"ll_counterparty_country\":\"Low\",\"customer_iban\":\"GB86TCCL12345657260776\",\"customer_date_of_birth\":\"1998-11-17T00:00:00+00:00\",\"counterparty_iban\":"+null+",\"counterparty_country\":\"US\",\"tx_base_balance\":\"30641.960000\",\"customer_ach_routing_code\":\"026073150\",\"customer_fedwire_routing_number\":\"026073008\"},\"rule_results\":[{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":17,\"name\":\"Percentage of Balance - Individual\",\"code\":\"POBI\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":18,\"name\":\"Percentage of Balance - Multiple\",\"code\":\"POBM\",\"alert_grouping_version\":\"7.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":22,\"name\":\"Smurfing - Inbound\",\"code\":\"SMURFIN\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":23,\"name\":\"New Customer - Outbound\",\"code\":\"NEWOUT\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":24,\"name\":\"High Value Outlier\",\"code\":\"HVO\",\"alert_grouping_version\":\"4.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":25,\"name\":\"Multiple Currencies\",\"code\":\"MCU\",\"alert_grouping_version\":\"4.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":27,\"name\":\"Vulnerable Customer - Outbound\",\"code\":\"VCO\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":31,\"name\":\"Modern Slavery & Sexual Exploitation\",\"code\":\"MSSE\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":32,\"name\":\"Movement of Funds\",\"code\":\"MOF\",\"alert_grouping_version\":\"4.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":34,\"name\":\"Exchange Services\",\"code\":\"EXSERV\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":35,\"name\":\"High Risk Country\",\"code\":\"HRCOU\",\"alert_grouping_version\":\"5.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":36,\"name\":\"Medium Risk Country\",\"code\":\"MRCOU\",\"alert_grouping_version\":\"5.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":45,\"name\":\"Prohibited Country\",\"code\":\"PCOU\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":47,\"name\":\"Low Risk Country\",\"code\":\"PRCLOW\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":48,\"name\":\"PEPs Screening\",\"code\":\"PEP\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":51,\"name\":\"Source of Wealth\",\"code\":\"SOW\",\"alert_grouping_version\":\"7.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":55,\"name\":\"Young Customer - USD\",\"code\":\"VCLOWUSD\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":56,\"name\":\"Elderly Customer - USD\",\"code\":\"VCELDUSD\",\"alert_grouping_version\":\"4.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":57,\"name\":\"Tax Haven Country - USD\",\"code\":\"TAXUSD\",\"alert_grouping_version\":\"5.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":58,\"name\":\"Account Selling - USD\",\"code\":\"SELLUSD\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":67,\"name\":\"Percentage of Balance\",\"code\":\"P-%BAL\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":68,\"name\":\"Payment Limit - Inbound\",\"code\":\"P-TLI\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":69,\"name\":\"Payment Limit - Outbound\",\"code\":\"P-TLO\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":70,\"name\":\"High Velocity - Outbound\",\"code\":\"P-HVO\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":71,\"name\":\"High Velocity - Inbound\",\"code\":\"P-HVI\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":72,\"name\":\"High Cumulative Amount - Outbound\",\"code\":\"P-HSUMO\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":73,\"name\":\"High Cumulative Amount - Inbound\",\"code\":\"P-HSUMI\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":74,\"name\":\"High Account Balance\",\"code\":\"P-LBAL\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":75,\"name\":\"First Transaction\",\"code\":\"P-1st\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":76,\"name\":\"Second transaction\",\"code\":\"P-2nd\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":77,\"name\":\"Similar Amounts - Inbound\",\"code\":\"IN>%OUT\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":78,\"name\":\"Similar Amounts - Outbound\",\"code\":\"OUT>%IN\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":79,\"name\":\"High Value Withdrawal Following High Number of Deposits\",\"code\":\"IN-OUT-2\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":80,\"name\":\"Withdrawal is Significant Percentage of Preceding Deposits\",\"code\":\"IN-OUT-1\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":81,\"name\":\"Structuring - Inbound - High Risk Limit\",\"code\":\"STRINHR\",\"alert_grouping_version\":\"4.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":86,\"name\":\"Structuring - Outbound - High Risk Limit\",\"code\":\"STROUTHR\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":87,\"name\":\"Vulnerable Customer\",\"code\":\"VC\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":88,\"name\":\"Round Value Transactions - Inbound\",\"code\":\"RVT-IN\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":89,\"name\":\"Round Value Transactions - Outbound\",\"code\":\"RVT-OUT\",\"alert_grouping_version\":\"4.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":90,\"name\":\"High Number of High Value Round Transactions - Inbound\",\"code\":\"HNR-IN\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":91,\"name\":\"High Number of High Value Round Transactions - Outbound\",\"code\":\"HNR-OUT\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":92,\"name\":\"New Counterparty Country\",\"code\":\"NCOU\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":93,\"name\":\"New Counterparty Bank Country\",\"code\":\"NBCOU\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":94,\"name\":\"High Risk Currency\",\"code\":\"HRCU\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":95,\"name\":\"New Currency\",\"code\":\"NCU\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":96,\"name\":\"Multiple Customers, One Counterparty (Distinct)\",\"code\":\"MCOC_1\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":97,\"name\":\"Multiple Counterparties, One Customer (Distinct)\",\"code\":\"OCMC_1\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":98,\"name\":\"High Cumulative Amount - Inbound - Counterparty\",\"code\":\"SUMCCI\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":99,\"name\":\"High Cumulative Amount - Outbound - Counterparty\",\"code\":\"SUMCCO\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":100,\"name\":\"High Velocity - Inbound - Counterparty\",\"code\":\"NUMCCI\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":101,\"name\":\"High Velocity - Outbound - Counterparty\",\"code\":\"NUMCCO\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":102,\"name\":\"Sudden Activity\",\"code\":\"DORMANT\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":103,\"name\":\"High Cumulative Amount Historic Average - Inbound\",\"code\":\"HASUMI\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":104,\"name\":\"High Cumulative Amount Historic Average - Outbound\",\"code\":\"HASUMO\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":105,\"name\":\"High Velocity Historic Average - Inbound\",\"code\":\"HANUMI\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":106,\"name\":\"High Velocity Historic Average - Outbound\",\"code\":\"HANUMO\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":107,\"name\":\"Transaction Limit - Historic Average - Inbound\",\"code\":\"IN>AVG\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":108,\"name\":\"Transaction Limit - Historic Average - Outbound\",\"code\":\"OUT>AVG\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":109,\"name\":\"High Velocity Safe Custody Account Usage - Historic Average\",\"code\":\"SAFE>HA\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":110,\"name\":\"Multiple Detail Change\",\"code\":\"CDC01\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":113,\"name\":\"Risk Words Counterparty Name\",\"code\":\"RISKNAME\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true}],\"updated_at\":\"2024-01-27T07:07:37.266597Z\"},\"extraData\":{\"reference\":\"588b4f25-f63c-4d03-b22e-2368aa7c03b9\",\"requestId\":\"588b4f25-f63c-4d03-b22e-2368aa7c03b9\",\"apiName\":\"regular\",\"locale\":\"en\",\"currency\":\"USD\",\"amount\":\"5\",\"debtorIban\":"+null+",\"creditorIban\":\"GB86TCCL12345657260776\",\"beneficiaryId\":\"eab23251-fafe-410a-af0c-1756e19fc937\",\"transferDescription\":\"settlement\",\"contactId\":\"aa8d1418-2e87-4f66-9505-eceb6a435d54\"},\"errors\":[]}";

        String p = "{\"result\":{\"id\":\"d199210e-20240121\",\"cancelled\":false,\"have_all_passed\":true,\"transaction_datetime\":\"2024-01-27T07:07:37Z\",\"internal_id\":244,\"source_format\":1,\"stored_data\":{\"tx_id\":\"d199210e-20240121\",\"tx_direction\":\"OUTBOUND\",\"tx_base_currency\":\"USD\",\"customer_id\":\"88815958\",\"customer_name\":\"Tosin David\",\"tx_base_amount\":\"2\",\"tx_currency\":\"USD\",\"tx_amount\":\"2\",\"tx_date_time\":\"2024-01-27T07:07:37+00:00\",\"counterparty_id\":\"77501097\",\"counterparty_name\":\"Mike Charles\",\"ll_counterparty_country\":\"Low\",\"customer_iban\":\"GB10TCCL12345677501097\",\"customer_date_of_birth\":\"1998-11-17T00:00:00+00:00\",\"counterparty_iban\":\"GB69TCCL12345688815958\",\"counterparty_country\":\"US\",\"tx_base_balance\":\"30641.960000\",\"customer_ach_routing_code\":\"026073150\",\"customer_fedwire_routing_number\":\"026073008\"},\"rule_results\":[{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":17,\"name\":\"Percentage of Balance - Individual\",\"code\":\"POBI\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":18,\"name\":\"Percentage of Balance - Multiple\",\"code\":\"POBM\",\"alert_grouping_version\":\"7.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":22,\"name\":\"Smurfing - Inbound\",\"code\":\"SMURFIN\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":23,\"name\":\"New Customer - Outbound\",\"code\":\"NEWOUT\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":24,\"name\":\"High Value Outlier\",\"code\":\"HVO\",\"alert_grouping_version\":\"4.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":25,\"name\":\"Multiple Currencies\",\"code\":\"MCU\",\"alert_grouping_version\":\"4.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":27,\"name\":\"Vulnerable Customer - Outbound\",\"code\":\"VCO\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":31,\"name\":\"Modern Slavery & Sexual Exploitation\",\"code\":\"MSSE\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":32,\"name\":\"Movement of Funds\",\"code\":\"MOF\",\"alert_grouping_version\":\"4.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":34,\"name\":\"Exchange Services\",\"code\":\"EXSERV\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":35,\"name\":\"High Risk Country\",\"code\":\"HRCOU\",\"alert_grouping_version\":\"5.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":36,\"name\":\"Medium Risk Country\",\"code\":\"MRCOU\",\"alert_grouping_version\":\"5.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":45,\"name\":\"Prohibited Country\",\"code\":\"PCOU\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":47,\"name\":\"Low Risk Country\",\"code\":\"PRCLOW\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":48,\"name\":\"PEPs Screening\",\"code\":\"PEP\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":51,\"name\":\"Source of Wealth\",\"code\":\"SOW\",\"alert_grouping_version\":\"7.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":55,\"name\":\"Young Customer - USD\",\"code\":\"VCLOWUSD\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":56,\"name\":\"Elderly Customer - USD\",\"code\":\"VCELDUSD\",\"alert_grouping_version\":\"4.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":57,\"name\":\"Tax Haven Country - USD\",\"code\":\"TAXUSD\",\"alert_grouping_version\":\"5.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":58,\"name\":\"Account Selling - USD\",\"code\":\"SELLUSD\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":67,\"name\":\"Percentage of Balance\",\"code\":\"P-%BAL\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":68,\"name\":\"Payment Limit - Inbound\",\"code\":\"P-TLI\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":69,\"name\":\"Payment Limit - Outbound\",\"code\":\"P-TLO\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":70,\"name\":\"High Velocity - Outbound\",\"code\":\"P-HVO\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":71,\"name\":\"High Velocity - Inbound\",\"code\":\"P-HVI\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":72,\"name\":\"High Cumulative Amount - Outbound\",\"code\":\"P-HSUMO\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":73,\"name\":\"High Cumulative Amount - Inbound\",\"code\":\"P-HSUMI\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":74,\"name\":\"High Account Balance\",\"code\":\"P-LBAL\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":75,\"name\":\"First Transaction\",\"code\":\"P-1st\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":76,\"name\":\"Second transaction\",\"code\":\"P-2nd\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":77,\"name\":\"Similar Amounts - Inbound\",\"code\":\"IN>%OUT\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":78,\"name\":\"Similar Amounts - Outbound\",\"code\":\"OUT>%IN\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":79,\"name\":\"High Value Withdrawal Following High Number of Deposits\",\"code\":\"IN-OUT-2\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":80,\"name\":\"Withdrawal is Significant Percentage of Preceding Deposits\",\"code\":\"IN-OUT-1\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":81,\"name\":\"Structuring - Inbound - High Risk Limit\",\"code\":\"STRINHR\",\"alert_grouping_version\":\"4.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":86,\"name\":\"Structuring - Outbound - High Risk Limit\",\"code\":\"STROUTHR\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":87,\"name\":\"Vulnerable Customer\",\"code\":\"VC\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":88,\"name\":\"Round Value Transactions - Inbound\",\"code\":\"RVT-IN\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":89,\"name\":\"Round Value Transactions - Outbound\",\"code\":\"RVT-OUT\",\"alert_grouping_version\":\"4.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":90,\"name\":\"High Number of High Value Round Transactions - Inbound\",\"code\":\"HNR-IN\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":91,\"name\":\"High Number of High Value Round Transactions - Outbound\",\"code\":\"HNR-OUT\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":92,\"name\":\"New Counterparty Country\",\"code\":\"NCOU\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":93,\"name\":\"New Counterparty Bank Country\",\"code\":\"NBCOU\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":94,\"name\":\"High Risk Currency\",\"code\":\"HRCU\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":95,\"name\":\"New Currency\",\"code\":\"NCU\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":96,\"name\":\"Multiple Customers, One Counterparty (Distinct)\",\"code\":\"MCOC_1\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":97,\"name\":\"Multiple Counterparties, One Customer (Distinct)\",\"code\":\"OCMC_1\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":98,\"name\":\"High Cumulative Amount - Inbound - Counterparty\",\"code\":\"SUMCCI\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":99,\"name\":\"High Cumulative Amount - Outbound - Counterparty\",\"code\":\"SUMCCO\",\"alert_grouping_version\":\"3.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":100,\"name\":\"High Velocity - Inbound - Counterparty\",\"code\":\"NUMCCI\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":101,\"name\":\"High Velocity - Outbound - Counterparty\",\"code\":\"NUMCCO\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":102,\"name\":\"Sudden Activity\",\"code\":\"DORMANT\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":103,\"name\":\"High Cumulative Amount Historic Average - Inbound\",\"code\":\"HASUMI\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":104,\"name\":\"High Cumulative Amount Historic Average - Outbound\",\"code\":\"HASUMO\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":105,\"name\":\"High Velocity Historic Average - Inbound\",\"code\":\"HANUMI\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":106,\"name\":\"High Velocity Historic Average - Outbound\",\"code\":\"HANUMO\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":107,\"name\":\"Transaction Limit - Historic Average - Inbound\",\"code\":\"IN>AVG\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":108,\"name\":\"Transaction Limit - Historic Average - Outbound\",\"code\":\"OUT>AVG\",\"alert_grouping_version\":\"2.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":109,\"name\":\"High Velocity Safe Custody Account Usage - Historic Average\",\"code\":\"SAFE>HA\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":110,\"name\":\"Multiple Detail Change\",\"code\":\"CDC01\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true},{\"message\":\"Transaction successfully passed the rule.\",\"rule\":{\"id\":113,\"name\":\"Risk Words Counterparty Name\",\"code\":\"RISKNAME\",\"alert_grouping_version\":\"1.0.0\"},\"has_passed\":true}],\"updated_at\":\"2024-01-27T07:07:37.266597Z\"},\"extraData\":{\"reference\":\"d199210e-20240121\",\"requestId\":\"d199210e-20240121\",\"apiName\":\"regular\",\"locale\":\"en\",\"currency\":\"USD\",\"amount\":\"2\",\"debtorIban\":\"GB15TCCL12345653302805\",\"creditorIban\":" + creditorIban + ",\"beneficiaryId\":\"eab23251-fafe-410a-af0c-1756e19fc937\",\"transferDescription\":\"salary\",\"contactId\":\"aa8d1418-2e87-4f66-9505-eceb6a435d54\"},\"errors\":[]}";
        ComplyAdvantageTransactionResponse complyAdvantageTransactionResponse = objectMapper.readValue(manualTransfer, ComplyAdvantageTransactionResponse.class);
        paymentManagementService.initiatePayment(complyAdvantageTransactionResponse);
        String paymentInitiationPayload = null;
        for (int i = 33; i < 34; i++) {
            paymentInitiationPayload = "{\"requestId\":\"id-payment-c21" + i + "\",\"request\":{\"fromAccountId\":1794," +
                    "\"fromAccountType\":4,\"toOfficeId\":1,\"toClientId\":888,\"toAccountType\":2,\"toAccountId\":1793," +
                    "\"transferAmount\":\"2.5\",\"transferDescription\":\"salary\",\"locale\":\"en\"," +
                    "\"fromClientId\":1658,\"fromOfficeId\":1,\"txDirection\":\"Outbound\",\"currency\":\"USD\"," +
                    "\"customerName\":\"Mike Charles\",\"counterpartyName\":\"Tosin David\"," +
                    "\"debtorIban\":\"GB65TCCL12345620046716\",\"counterpartyCountry\":\"US\",\"creditorIban\":" + null + ",\"beneficiaryId\":\"74587beb-887a-4dba-b87d-050839ae090d\",\"contactId\":\"ffb3eb02-01b8-436d-9801-4ce1169788a6\",\"paymentType\":\"regular\"," +
                    "\"reference\":\"id-payment-c21" + i + "\"},\"apiName\":\"payment-initiation\",\"partition\":27}";
//            eventProducer.sendEventToPartition(paymentInitiationPayload, CLEAR_BANK_TOPIC, 27, "payment-initiation");

        }
        TypeReference<RovaRequestPayload<RovaAccountTransferDto>> reference = new TypeReference<RovaRequestPayload<RovaAccountTransferDto>>() {
        };
        RovaRequestPayload<RovaAccountTransferDto> rovaRequestPayload = objectMapper.readValue(paymentInitiationPayload, reference);
//        paymentManagementService.debitCustomerCreditTransitGl(rovaRequestPayload);
    }

    @Test
    void directDebitInstructionCreationTest() {
        String directDebitInstructionCreationPayload = "{\"requestId\":\"id-amend1\",\"request\":{\"externalAccountId\":\"b7146585-443c-46c2-b8df-fae25c89089b\",\"serviceUserNumber\":\"123456\",\"originatorName\":\"ORG-123\",\"reference\":\"REF456\",\"payerName\":\"PAYERNAME789\",\"counterpartAccount\":{\"identification\":{\"iban\":\"GB38CLRB04069500000029\",\"other\":{\"identification\":\"id123\",\"schemeName\":{\"code\":\"BBAN\",\"proprietary\":\"string\"},\"issuer\":\"string\"}}},\"mandateType\":\"PaperMandate\",\"fromOfficeId\":1,\"fromClientId\":4,\"fromAccountType\":2,\"name\":\"RENTALZ\",\"transferType\":1,\"priority\":2,\"status\":1,\"fromAccountId\":24,\"toOfficeId\":1,\"toClientId\":70,\"toAccountType\":2,\"toAccountId\":53,\"instructionType\":1,\"amount\":\"20\",\"validFrom\":\"05 October 2023\",\"validTill\":\"05 October 2024\",\"recurrenceType\":1,\"recurrenceInterval\":\"1\",\"recurrenceFrequency\":2,\"locale\":\"en\",\"dateFormat\":\"dd MMMM yyyy\",\"recurrenceOnMonthDay\":\"06 October\",\"monthDayFormat\":\"dd MMMM\"},\"apiName\":\"direct-debit-instruction-creation\",\"partition\":42}";
        eventProducer.sendEventToPartition(directDebitInstructionCreationPayload, CLEAR_BANK_TOPIC, 42, "direct-debit-instruction-creation");
    }

    @Test
    void directDebitInstructionAmendmentTest() {
        String directDebitInstructionAmendmentPayload = "{\"requestId\":\"id-amend1\",\"request\":{\"externalAccountId\":\"b7146585-443c-46c2-b8df-fae25c89089b\",\"mandateId\":\"b7146585-443c-46c2-b8df-fae25c89089c\",\"standingInstructionId\":\"2\",\"reasonCode\":\"C\",\"newDebtorAccount\":{\"identification\":{\"iban\":\"GB38CLRB04069500000029\",\"other\":{\"issuer\":\"Gen Seg Acc Wsale\",\"identification\":\"id123\",\"schemeName\":{\"code\":\"BBAN\",\"proprietary\":\"string\"}}}},\"priority\":2,\"status\":1,\"instructionType\":1,\"amount\":\"260\",\"validFrom\":\"05 October 2023\",\"validTill\":\"05 October 2024\",\"recurrenceType\":1,\"recurrenceInterval\":1,\"recurrenceFrequency\":2,\"locale\":\"en\",\"dateFormat\":\"dd MMMM yyyy\",\"recurrenceOnMonthDay\":\"06 October\",\"monthDayFormat\":\"dd MMM\"},\"apiName\":\"direct-debit-instruction-amendment\",\"partition\":48}";
        eventProducer.sendEventToPartition(directDebitInstructionAmendmentPayload, CLEAR_BANK_TOPIC, 48, "direct-debit-instruction-amendment");
    }

    @Test
    void directDebitInstructionDeletionTest() {
        String directDebitInstructionDeletionPayload = "{\"requestId\":\"id-delete\",\"request\":{\"externalAccountId\":\"b7146585-443c-46c2-b8df-fae25c89089b\",\"mandateId\":\"b7146585-443c-46c2-b8df-fae25c89089c\",\"reasonCode\":\"0\",\"standingInstructionId\":\"1\"},\"apiName\":\"account-ammendment\",\"partition\":54}";
        eventProducer.sendEventToPartition(directDebitInstructionDeletionPayload, CLEAR_BANK_TOPIC, 54, "direct-debit-instruction-deletion");
    }

    @Test
    void datePatternTest() {
        String DATE_PATTERN = "\\d{4}-\\d{2}-\\d{2}";
        System.out.println(Pattern.matches(DATE_PATTERN, "2000-11-17"));
        System.out.println(Pattern.matches(DATE_PATTERN, "2000/11/17"));
        System.out.println(Pattern.matches(DATE_PATTERN, "17-11-2000"));
    }

}